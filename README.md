# TopActivityTool

一款轻量级 Android 开发者工具，通过悬浮窗实时显示当前屏幕中前台 Activity 的详细信息。

## ✨ 功能特性

- 📱 **实时监控** — 悬浮窗实时显示当前前台应用名称及 Activity 完整类名
- 🖐️ **拖拽移动** — 拖拽标题栏自由移动悬浮窗位置
- 🔍 **放大缩小** — 通过 +/- 按钮调节文字大小，悬浮窗自适应缩放
- ⚡ **快捷开关** — 下拉状态栏 Quick Settings 磁贴一键开启/关闭
- 📜 **历史记录** — 可选查看 Activity 打开历史，支持清空
- 🔔 **通知控制** — 前台通知常驻，可直接从通知栏停止服务

## 📸 使用方式

1. 打开应用，依次授权三项权限：
   - **悬浮窗权限** — 用于在其他应用上方显示悬浮窗
   - **使用情况访问权限** — 用于获取当前前台 Activity 信息
   - **通知权限** — 用于显示前台服务通知
2. 点击「**启动服务**」，屏幕左上角将出现悬浮窗
3. 切换到任意应用，悬浮窗将实时显示当前 Activity 信息

### 悬浮窗操作

| 操作 | 说明 |
|------|------|
| 拖拽标题栏 | 移动悬浮窗位置 |
| 点击 **−** | 缩小文字 |
| 点击 **+** | 放大文字 |
| 点击 🕐 | 显示/隐藏 Activity 历史记录 |
| 点击 **✕** | 关闭悬浮窗并停止服务 |

### Quick Settings 快捷磁贴

下拉状态栏 → 编辑磁贴 → 添加「**Activity监控**」磁贴，之后即可从状态栏快速切换开关。

## 🔧 技术实现

| 模块 | 说明 |
|------|------|
| `MainActivity` | 权限管理界面，检测并引导用户授权所需权限 |
| `FloatingWindowService` | 前台服务，负责悬浮窗创建、拖拽、缩放及 Activity 信息轮询 |
| `TopActivityTileService` | Quick Settings 磁贴服务，支持状态栏快捷开关 |

### 核心原理

通过 `UsageStatsManager.queryEvents()` 查询系统使用事件，获取最近的 `ACTIVITY_RESUMED` 事件，从中提取前台应用的包名和 Activity 类名。

### 所需权限

| 权限 | 用途 |
|------|------|
| `SYSTEM_ALERT_WINDOW` | 在其他应用上方绘制悬浮窗 |
| `PACKAGE_USAGE_STATS` | 获取当前前台 Activity 信息 |
| `QUERY_ALL_PACKAGES` | 查询其他应用信息以获取应用名称 |
| `FOREGROUND_SERVICE` | 保持服务在后台持续运行 |
| `POST_NOTIFICATIONS` | 显示前台服务通知（Android 13+） |

## 📋 环境要求

- **最低系统版本**: Android 7.0 (API 24)
- **目标系统版本**: Android 16 (API 36)
- **开发语言**: Kotlin
- **构建工具**: Gradle 8.13.2 + AGP 8.13.2

## 📄 License

本项目仅供学习和开发调试使用。
